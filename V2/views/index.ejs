<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= config.app.name %></title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/tooltips.css">
</head>
<body>
    <div id="particles-js" class="particle-background"></div>
    
    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1><%= config.app.name %></h1>
            <div class="last-updated">
                <span id="update-time"><%= moment().format('HH:mm:ss') %></span>
            </div>
        </div>

        <!-- Stats overview -->
        <div class="overview-grid">
            <div class="overview-card" data-tooltip="Number of services being monitored">
                <h3><i class="fa-solid fa-server"></i> Total Services</h3>
                <div class="value" id="total-services">
                    <%= stats.totalServices %>
                    <% if (stats.totalServices > 0) { %>
                        <span class="change positive">+1</span>
                    <% } %>
                </div>
            </div>
            <div class="overview-card" data-tooltip="Services currently online and responding">
                <h3><i class="fa-solid fa-check-circle"></i> Services Up</h3>
                <div class="value" id="services-up">
                    <%= stats.servicesUp %>
                    <span class="change positive">
                        <%= Math.round((stats.servicesUp / stats.totalServices) * 100) %>%
                    </span>
                </div>
            </div>
            <div class="overview-card" data-tooltip="Services currently down or not responding">
                <h3><i class="fa-solid fa-exclamation-circle"></i> Services Down</h3>
                <div class="value" id="services-down">
                    <%= stats.servicesDown %>
                    <% if (stats.servicesDown > 0) { %>
                        <span class="change negative">
                            <%= Math.round((stats.servicesDown / stats.totalServices) * 100) %>%
                        </span>
                    <% } %>
                </div>
            </div>
            <div class="overview-card" data-tooltip="Average ping time across all services">
                <h3><i class="fa-solid fa-bolt"></i> Average Response</h3>
                <div class="value <%= stats.averagePing < 200 ? 'good' : stats.averagePing < 500 ? 'warning' : 'danger' %>" id="average-ping">
                    <%= stats.averagePing %> ms
                </div>
            </div>
        </div>
        
        <!-- Services section -->
        <h2 class="section-title"><i class="fa-solid fa-rectangle-list"></i> Service Status</h2>
        
        <div class="services-grid">
            <% services.forEach(service => { 
                const data = serviceData.get(service.name);
                const statusClass = data.status === 'up' ? 'online' : 'offline';
                const pingValue = data.ping && data.ping.length ? data.ping[data.ping.length - 1] : 'N/A';
                const pingClass = 
                    pingValue === 'N/A' ? '' :
                    pingValue < 200 ? 'good' :
                    pingValue < 500 ? 'warning' : 'danger';
                const healthClass = 
                    data.healthScore > 90 ? 'good' :
                    data.healthScore > 70 ? 'warning' : 'danger';
                const safeServiceName = service.name.replace(/\s+/g, '_');
            %>
                <div class="service-card <%= statusClass %>" id="<%= safeServiceName %>-card">
                    <div class="service-header">
                        <div class="service-title">
                            <div class="status-indicators">
                                <span class="status-dot online <%= data.status === 'up' ? 'active' : '' %>" 
                                      data-tooltip="Service is online" 
                                      data-tooltip-theme="success"></span>
                                <span class="status-dot offline <%= data.status === 'down' ? 'active' : '' %>" 
                                      data-tooltip="Service is offline" 
                                      data-tooltip-theme="error"></span>
                            </div>
                            <h3><%= service.name %></h3>
                        </div>
                        <span class="category-tag" data-tooltip="Service category" data-tooltip-position="bottom"><%= service.category %></span>
                    </div>
                    
                    <div class="metrics-grid">
                        <div class="metric" data-tooltip="Time to receive a response">
                            <div class="metric-label">
                                <i class="fa-solid fa-tachometer-alt"></i> Response Time
                            </div>
                            <div class="metric-value <%= pingClass %>" id="<%= safeServiceName %>-ping">
                                <%= pingValue %> ms
                            </div>
                        </div>
                        
                        <div class="metric" data-tooltip="Overall health based on response time and uptime">
                            <div class="metric-label">
                                <i class="fa-solid fa-heart-pulse"></i> Health Score
                            </div>
                            <div class="metric-value <%= healthClass %>" id="<%= safeServiceName %>-health">
                                <%= data.healthScore %>%
                            </div>
                            <div class="progress-bar">
                                <div class="progress-bar-fill <%= healthClass %>" style="width: <%= data.healthScore %>%"></div>
                            </div>
                        </div>
                        
                        <div class="metric" data-tooltip="Percentage of time the service has been up">
                            <div class="metric-label">
                                <i class="fa-solid fa-arrow-up"></i> Uptime
                            </div>
                            <div class="metric-value <%= parseFloat(data.uptime) > 95 ? 'good' : parseFloat(data.uptime) > 90 ? 'warning' : 'danger' %>" id="<%= safeServiceName %>-uptime">
                                <%= data.uptime %>%
                            </div>
                            <div class="progress-bar">
                                <div class="progress-bar-fill <%= parseFloat(data.uptime) > 95 ? 'success' : parseFloat(data.uptime) > 90 ? 'warning' : 'danger' %>" style="width: <%= data.uptime %>%"></div>
                            </div>
                        </div>
                        
                        <div class="metric" data-tooltip="Time of last status check">
                            <div class="metric-label">
                                <i class="fa-solid fa-clock"></i> Last Check
                            </div>
                            <div class="metric-value" id="<%= safeServiceName %>-lastcheck">
                                <%= moment(data.lastCheck).format('HH:mm:ss') %>
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <canvas id="<%= safeServiceName %>-chart"></canvas>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </div>
    
    <footer class="dashboard-footer">
        <div class="footer-content">
            <div class="copyright">© <%= new Date().getFullYear() %> <%= config.footer.copyright %> • <span class="version">v<%= version %></span></div>
            <div class="footer-links">
                <a href="https://hexrift.net/discord" data-tooltip="View documentation" data-tooltip-position="top"><i class="fa-solid fa-book"></i> Docs</a>
                <a href="https://hexrift.net/discord" data-tooltip="Get support" data-tooltip-position="top"><i class="fa-solid fa-headset"></i> Support</a>
                <a href="https://github.com/HexRift-LLC" target="_blank" data-tooltip="Visit our GitHub" data-tooltip-position="top"><i class="fa-brands fa-github"></i> GitHub</a>
            </div>
        </div>
    </footer>
    
    <!-- Toast notification container -->
    <div id="toast-container"></div>
    
    <script src="/js/index.js"></script>
    <% if (config.analytics.google.enabled) { %>
        <!-- Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=<%= config.analytics.google.tracking_id %>"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', '<%= config.analytics.google.tracking_id %>');
        </script>
    <% } %>
    <script src="/js/particles.js"></script>
    
    <!-- Toast notification demo -->
    <script>
        // Show a welcome toast when page loads
        setTimeout(() => {
            const toast = document.createElement('div');
            toast.className = 'toast success';
            toast.innerHTML = '<i class="fa-solid fa-circle-check"></i> Welcome to <%= config.app.name %>!';
            document.getElementById('toast-container').appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }, 1000);
    </script>
</body>
</html>
